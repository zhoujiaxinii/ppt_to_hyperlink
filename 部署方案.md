# PPTæ–‡ä»¶è¶…é“¾æ¥è½¬æ¢ç³»ç»Ÿ - éƒ¨ç½²æ–¹æ¡ˆæ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
- [éƒ¨ç½²æ–¹å¼é€‰æ‹©](#éƒ¨ç½²æ–¹å¼é€‰æ‹©)
- [å¿«é€Ÿéƒ¨ç½²æ–¹æ¡ˆ](#å¿«é€Ÿéƒ¨ç½²æ–¹æ¡ˆ)
- [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆ](#ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆ)
- [Dockeré•œåƒéƒ¨ç½²æ–¹æ¡ˆ](#dockeré•œåƒéƒ¨ç½²æ–¹æ¡ˆ)
- [é«˜å¯ç”¨ç”Ÿäº§ç¯å¢ƒæ–¹æ¡ˆ](#é«˜å¯ç”¨ç”Ÿäº§ç¯å¢ƒæ–¹æ¡ˆ)
- [éƒ¨ç½²åéªŒè¯](#éƒ¨ç½²åéªŒè¯)
- [è¿ç»´ç®¡ç†](#è¿ç»´ç®¡ç†)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)

---

## ç³»ç»Ÿæ¦‚è¿°

PPTæ–‡ä»¶è¶…é“¾æ¥è½¬æ¢ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºFlaskçš„RESTful APIæœåŠ¡ï¼Œæä¾›ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- ğŸ”— è‡ªåŠ¨è¯†åˆ«PPTXä¸­çš„åª’ä½“é“¾æ¥ï¼ˆ.mp3, .mp4, .wavç­‰ï¼‰
- ğŸ® è¯†åˆ«ç‰¹å®šæ ¼å¼çš„æ¸¸æˆé“¾æ¥ï¼ˆindex.html?data_url=...jsonï¼‰
- âš¡ å°†è¯†åˆ«çš„é“¾æ¥è½¬æ¢ä¸ºå¯ç‚¹å‡»çš„è¶…é“¾æ¥
- â˜ï¸ è‡ªåŠ¨ä¸Šä¼ å¤„ç†åçš„æ–‡ä»¶åˆ°è…¾è®¯äº‘COS
- ğŸ³ æ”¯æŒDockerå®¹å™¨åŒ–éƒ¨ç½²

---

## ç¯å¢ƒè¦æ±‚

### æœ€ä½ç³»ç»Ÿè¦æ±‚

| ç»„ä»¶ | æœ€ä½è¦æ±‚ | æ¨èé…ç½® |
|------|----------|----------|
| **æ“ä½œç³»ç»Ÿ** | Linux (Ubuntu 18.04+, CentOS 7+) | Ubuntu 20.04 LTS |
| **CPU** | 1æ ¸ | 2æ ¸+ |
| **å†…å­˜** | 1GB | 2GB+ |
| **å­˜å‚¨** | 5GB | 20GB+ |
| **ç½‘ç»œ** | å‡ºç«™è®¿é—®è…¾è®¯äº‘COS | ç¨³å®šç½‘ç»œè¿æ¥ |

### è½¯ä»¶ä¾èµ–

| è½¯ä»¶ | ç‰ˆæœ¬è¦æ±‚ | å®‰è£…è¯´æ˜ |
|------|----------|----------|
| **Docker** | 20.10+ | å¿…éœ€ |
| **Docker Compose** | 1.28+ | æ¨è |
| **Python** | 3.11+ | å®¹å™¨å†…è‡ªåŠ¨å®‰è£… |
| **Nginx** | 1.18+ | ç”Ÿäº§ç¯å¢ƒæ¨è |
| **curl** | ä»»æ„ç‰ˆæœ¬ | ç”¨äºå¥åº·æ£€æŸ¥ |

---

## éƒ¨ç½²æ–¹å¼é€‰æ‹©

æ ¹æ®æ‚¨çš„ä½¿ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„éƒ¨ç½²æ–¹å¼ï¼š

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | å¤æ‚åº¦ | éƒ¨ç½²æ—¶é—´ |
|------|----------|--------|----------|
| **å¼€å‘æµ‹è¯•** | [å¿«é€Ÿéƒ¨ç½²æ–¹æ¡ˆ](#å¿«é€Ÿéƒ¨ç½²æ–¹æ¡ˆ) | â­ | 5åˆ†é’Ÿ |
| **å°å‹ç”Ÿäº§** | [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆ](#ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆ) | â­â­ | 10åˆ†é’Ÿ |
| **ä¼ä¸šç”Ÿäº§** | [é«˜å¯ç”¨ç”Ÿäº§ç¯å¢ƒæ–¹æ¡ˆ](#é«˜å¯ç”¨ç”Ÿäº§ç¯å¢ƒæ–¹æ¡ˆ) | â­â­â­ | 30åˆ†é’Ÿ |
| **CI/CDé›†æˆ** | [Dockeré•œåƒéƒ¨ç½²æ–¹æ¡ˆ](#dockeré•œåƒéƒ¨ç½²æ–¹æ¡ˆ) | â­â­ | 15åˆ†é’Ÿ |

---

## å¿«é€Ÿéƒ¨ç½²æ–¹æ¡ˆ

é€‚ç”¨äºå¼€å‘æµ‹è¯•ç¯å¢ƒï¼Œå¿«é€ŸéªŒè¯åŠŸèƒ½ã€‚

### æ­¥éª¤ 1: å‡†å¤‡éƒ¨ç½²æ–‡ä»¶

```bash
# åœ¨æœ¬åœ°æ‰“åŒ…é¡¹ç›®
cd "d:\code"
tar -czf ppt_hyperlink.tar.gz ppt_hyperlink/

# ä¼ è¾“åˆ°æœåŠ¡å™¨
scp ppt_hyperlink.tar.gz username@server-ip:/home/username/
```

### æ­¥éª¤ 2: æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡

```bash
# ç™»å½•æœåŠ¡å™¨
ssh username@server-ip

# å®‰è£…Dockerï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
# Ubuntu/Debian
sudo apt update
sudo apt install -y docker.io docker-compose

# CentOS/RHEL
sudo yum install -y docker docker-compose

# å¯åŠ¨DockeræœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker

# å°†ç”¨æˆ·åŠ å…¥dockerç»„ï¼ˆå¯é€‰ï¼‰
sudo usermod -aG docker $USER
```

### æ­¥éª¤ 3: éƒ¨ç½²åº”ç”¨

```bash
# è§£å‹é¡¹ç›®æ–‡ä»¶
tar -xzf ppt_hyperlink.tar.gz
cd ppt_hyperlink/

# ä½¿ç”¨ä¸€é”®éƒ¨ç½²è„šæœ¬
bash deploy.sh
```

### æ­¥éª¤ 4: éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:5000/health

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps
```

**é¢„æœŸç»“æœï¼š**
- APIæœåŠ¡è¿è¡Œåœ¨ `http://server-ip:5000`
- å¥åº·æ£€æŸ¥è¿”å› `{"status": "healthy"}`

---

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆ

é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼ŒåŒ…å«å®Œæ•´çš„ç›‘æ§å’Œæ—¥å¿—é…ç½®ã€‚

### æ–¹æ¡ˆæ¦‚è¿°

```mermaid
graph TB
    A[ç”¨æˆ·è¯·æ±‚] --> B[Nginxåå‘ä»£ç†]
    B --> C[Flask APIå®¹å™¨]
    C --> D[è…¾è®¯äº‘COS]
    C --> E[æœ¬åœ°ä¸´æ—¶å­˜å‚¨]
    F[ç›‘æ§ç³»ç»Ÿ] --> C
    G[æ—¥å¿—ç³»ç»Ÿ] --> C
```

### æ­¥éª¤ 1: ä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
# åœ¨æœ¬åœ°æ‰§è¡Œï¼ˆè‡ªåŠ¨åŒ–æ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹ï¼‰
cd "d:\code\ppt_hyperlink"
bash prod-deploy.sh <server-ip> <username>

# ä¾‹å¦‚
bash prod-deploy.sh 192.168.1.100 ubuntu
```

### æ­¥éª¤ 2: é…ç½®Nginxåå‘ä»£ç†

```bash
# åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…Nginx
sudo apt install -y nginx  # Ubuntu/Debian
# æˆ–
sudo yum install -y nginx  # CentOS/RHEL

# å¤åˆ¶Nginxé…ç½®æ–‡ä»¶
sudo cp nginx.conf /etc/nginx/sites-available/ppt-api
sudo ln -s /etc/nginx/sites-available/ppt-api /etc/nginx/sites-enabled/

# ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„åŸŸå
sudo nano /etc/nginx/sites-available/ppt-api
# å°† your-domain.com æ›¿æ¢ä¸ºå®é™…åŸŸåæˆ–IP

# æµ‹è¯•é…ç½®å¹¶é‡å¯
sudo nginx -t
sudo systemctl restart nginx
```

### æ­¥éª¤ 3: é…ç½®é˜²ç«å¢™

```bash
# Ubuntu/Debian (ä½¿ç”¨ufw)
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 5000/tcp  # å¦‚æœéœ€è¦ç›´æ¥è®¿é—®API

# CentOS/RHEL (ä½¿ç”¨firewalld)
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --permanent --add-port=5000/tcp
sudo firewall-cmd --reload
```

### æ­¥éª¤ 4: é…ç½®SSLè¯ä¹¦ï¼ˆæ¨èï¼‰

```bash
# ä½¿ç”¨Let's Encryptå…è´¹è¯ä¹¦
sudo apt install -y certbot python3-certbot-nginx

# è·å–SSLè¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œï¼š
# 0 12 * * * /usr/bin/certbot renew --quiet
```

**éƒ¨ç½²ç»“æœï¼š**
- HTTPè®¿é—®ï¼š`http://your-domain.com`
- HTTPSè®¿é—®ï¼š`https://your-domain.com`
- ç›´æ¥APIè®¿é—®ï¼š`http://your-domain.com:5000`

---

## Dockeré•œåƒéƒ¨ç½²æ–¹æ¡ˆ

é€‚ç”¨äºCI/CDé›†æˆå’Œé•œåƒåˆ†å‘åœºæ™¯ã€‚

### æ–¹æ¡ˆ A: æœ¬åœ°æ„å»ºå’Œä¼ è¾“

```bash
# 1. æ„å»ºDockeré•œåƒ
cd "d:\code\ppt_hyperlink"
docker build -t ppt-hyperlink-converter:v1.0 .

# 2. ä¿å­˜é•œåƒä¸ºæ–‡ä»¶
docker save -o ppt-hyperlink-converter-v1.0.tar ppt-hyperlink-converter:v1.0

# 3. ä¼ è¾“åˆ°æœåŠ¡å™¨
scp ppt-hyperlink-converter-v1.0.tar username@server-ip:/home/username/

# 4. åœ¨æœåŠ¡å™¨ä¸ŠåŠ è½½å¹¶è¿è¡Œ
ssh username@server-ip
docker load -i ppt-hyperlink-converter-v1.0.tar
docker run -d \
  --name ppt-api \
  --restart unless-stopped \
  -p 5000:5000 \
  -v /tmp:/tmp \
  ppt-hyperlink-converter:v1.0
```

### æ–¹æ¡ˆ B: Docker Registry

```bash
# 1. æ¨é€åˆ°Docker Hubï¼ˆéœ€è¦Docker Hubè´¦å·ï¼‰
docker login
docker tag ppt-hyperlink-converter:v1.0 yourusername/ppt-hyperlink-converter:v1.0
docker push yourusername/ppt-hyperlink-converter:v1.0

# 2. åœ¨æœåŠ¡å™¨ä¸Šæ‹‰å–è¿è¡Œ
ssh username@server-ip
docker pull yourusername/ppt-hyperlink-converter:v1.0
docker run -d \
  --name ppt-api \
  --restart unless-stopped \
  -p 5000:5000 \
  -v /tmp:/tmp \
  yourusername/ppt-hyperlink-converter:v1.0
```

### æ–¹æ¡ˆ C: ç§æœ‰Registry

```bash
# æ­å»ºç§æœ‰Registry
docker run -d \
  --name registry \
  --restart unless-stopped \
  -p 5000:5000 \
  -v /opt/registry:/var/lib/registry \
  registry:2

# æ¨é€é•œåƒåˆ°ç§æœ‰Registry
docker tag ppt-hyperlink-converter:v1.0 registry-server:5000/ppt-hyperlink-converter:v1.0
docker push registry-server:5000/ppt-hyperlink-converter:v1.0
```

---

## é«˜å¯ç”¨ç”Ÿäº§ç¯å¢ƒæ–¹æ¡ˆ

é€‚ç”¨äºä¼ä¸šçº§ç”Ÿäº§ç¯å¢ƒï¼Œæä¾›é«˜å¯ç”¨æ€§å’Œè´Ÿè½½å‡è¡¡ã€‚

### æ¶æ„å›¾

```mermaid
graph TB
    A[è´Ÿè½½å‡è¡¡å™¨] --> B[Nginx-1]
    A --> C[Nginx-2]
    B --> D[APIå®¹å™¨-1]
    B --> E[APIå®¹å™¨-2]
    C --> F[APIå®¹å™¨-3]
    C --> G[APIå®¹å™¨-4]
    D --> H[è…¾è®¯äº‘COS]
    E --> H
    F --> H
    G --> H
    I[ç›‘æ§ç³»ç»Ÿ] --> D
    I --> E
    I --> F
    I --> G
    J[æ—¥å¿—èšåˆ] --> D
    J --> E
    J --> F
    J --> G
```

### æ­¥éª¤ 1: å¤šå®ä¾‹éƒ¨ç½²

```bash
# åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®
cd ppt_hyperlink/

# å¯åŠ¨å¤šä¸ªAPIå®ä¾‹
docker-compose -f docker-compose.prod.yml up -d --scale ppt-hyperlink-converter=4
```

### æ­¥éª¤ 2: è´Ÿè½½å‡è¡¡é…ç½®

åˆ›å»ºé«˜çº§Nginxé…ç½®ï¼š

```nginx
# /etc/nginx/conf.d/ppt-api-lb.conf
upstream ppt_api {
    least_conn;
    server 127.0.0.1:5001 max_fails=3 fail_timeout=30s;
    server 127.0.0.1:5002 max_fails=3 fail_timeout=30s;
    server 127.0.0.1:5003 max_fails=3 fail_timeout=30s;
    server 127.0.0.1:5004 max_fails=3 fail_timeout=30s;
}

server {
    listen 80;
    server_name your-domain.com;

    client_max_body_size 100M;

    location / {
        proxy_pass http://ppt_api;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_connect_timeout 60s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;

        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503;
    }

    location /health {
        proxy_pass http://ppt_api/health;
        access_log off;
    }
}
```

### æ­¥éª¤ 3: ç›‘æ§é…ç½®

åˆ›å»ºç›‘æ§è„šæœ¬ï¼š

```bash
#!/bin/bash
# monitor.sh - æœåŠ¡ç›‘æ§è„šæœ¬

check_service() {
    local port=$1
    local service_name=$2

    if curl -f http://localhost:$port/health > /dev/null 2>&1; then
        echo "âœ… $service_name (port $port) - æ­£å¸¸"
        return 0
    else
        echo "âŒ $service_name (port $port) - å¼‚å¸¸"
        return 1
    fi
}

echo "=== PPT API æœåŠ¡ç›‘æ§ $(date) ==="

# æ£€æŸ¥å„ä¸ªå®ä¾‹
check_service 5001 "APIå®ä¾‹1"
check_service 5002 "APIå®ä¾‹2"
check_service 5003 "APIå®ä¾‹3"
check_service 5004 "APIå®ä¾‹4"

# æ£€æŸ¥Nginx
if systemctl is-active --quiet nginx; then
    echo "âœ… Nginx - æ­£å¸¸"
else
    echo "âŒ Nginx - å¼‚å¸¸"
fi

# æ£€æŸ¥ç£ç›˜ç©ºé—´
disk_usage=$(df -h /tmp | awk 'NR==2 {print $5}' | sed 's/%//')
if [ $disk_usage -gt 80 ]; then
    echo "âš ï¸  ç£ç›˜ä½¿ç”¨ç‡: ${disk_usage}% (å»ºè®®æ¸…ç†)"
else
    echo "âœ… ç£ç›˜ä½¿ç”¨ç‡: ${disk_usage}%"
fi
```

### æ­¥éª¤ 4: è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# ha-deploy.sh - é«˜å¯ç”¨éƒ¨ç½²è„šæœ¬

set -e

echo "=== é«˜å¯ç”¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² ==="

# åœæ­¢æ—§æœåŠ¡
echo "ğŸ›‘ åœæ­¢æ—§æœåŠ¡..."
docker-compose -f docker-compose.prod.yml down

# æ‹‰å–æœ€æ–°é•œåƒ
echo "ğŸ“¥ æ‹‰å–æœ€æ–°é•œåƒ..."
docker-compose -f docker-compose.prod.yml pull

# å¯åŠ¨å¤šå®ä¾‹æœåŠ¡
echo "ğŸš€ å¯åŠ¨å¤šå®ä¾‹æœåŠ¡..."
docker-compose -f docker-compose.prod.yml up -d --scale ppt-hyperlink-converter=4

# ç­‰å¾…æœåŠ¡å¯åŠ¨
echo "â³ ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 30

# å¥åº·æ£€æŸ¥
echo "ğŸ” æ‰§è¡Œå¥åº·æ£€æŸ¥..."
bash monitor.sh

# é‡è½½Nginxé…ç½®
echo "ğŸ”„ é‡è½½Nginxé…ç½®..."
sudo nginx -t && sudo systemctl reload nginx

echo "âœ… é«˜å¯ç”¨éƒ¨ç½²å®Œæˆï¼"
```

---

## éƒ¨ç½²åéªŒè¯

### åŸºç¡€åŠŸèƒ½éªŒè¯

```bash
# 1. å¥åº·æ£€æŸ¥
curl -f http://your-domain.com/health
# æœŸæœ›è¿”å›: {"status": "healthy", "service": "PPT Hyperlink Converter"}

# 2. APIæ–‡æ¡£æ£€æŸ¥
curl http://your-domain.com/
# æœŸæœ›è¿”å›: APIæ–‡æ¡£JSON

# 3. åŠŸèƒ½æµ‹è¯•ï¼ˆä½¿ç”¨æµ‹è¯•æ–‡ä»¶ï¼‰
curl -X POST \
     -H "Content-Type: application/json" \
     -d '{"pptx_url": "https://example.com/test.pptx"}' \
     http://your-domain.com/process_pptx
```

### æ€§èƒ½éªŒè¯

```bash
# å¹¶å‘æµ‹è¯•
for i in {1..10}; do
    curl -X POST \
         -H "Content-Type: application/json" \
         -d '{"pptx_url": "https://example.com/test.pptx"}' \
         http://your-domain.com/process_pptx &
done
wait
```

### ç›‘æ§éªŒè¯

```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps

# æ£€æŸ¥èµ„æºä½¿ç”¨
docker stats

# æ£€æŸ¥æ—¥å¿—
docker-compose logs -f --tail=50
```

---

## è¿ç»´ç®¡ç†

### æ—¥å¸¸è¿ç»´å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose logs -f

# é‡å¯æœåŠ¡
docker-compose restart

# æ›´æ–°æœåŠ¡
docker-compose pull && docker-compose up -d

# æ‰©å®¹æœåŠ¡
docker-compose up -d --scale ppt-hyperlink-converter=6

# ç¼©å®¹æœåŠ¡
docker-compose up -d --scale ppt-hyperlink-converter=2
```

### å¤‡ä»½å’Œæ¢å¤

```bash
# å¤‡ä»½é…ç½®æ–‡ä»¶
tar -czf ppt-api-backup-$(date +%Y%m%d).tar.gz \
    docker-compose*.yml \
    nginx.conf \
    *.sh

# å¤‡ä»½Dockeré•œåƒ
docker save -o ppt-api-image-backup.tar ppt-hyperlink-converter:latest

# æ¢å¤æœåŠ¡
tar -xzf ppt-api-backup-*.tar.gz
docker load -i ppt-api-image-backup.tar
docker-compose up -d
```

### æ—¥å¿—ç®¡ç†

```bash
# è®¾ç½®æ—¥å¿—è½®è½¬
sudo tee /etc/logrotate.d/ppt-api << EOF
/var/log/nginx/ppt-api-*.log {
    daily
    missingok
    rotate 7
    compress
    delaycompress
    notifempty
    postrotate
        systemctl reload nginx
    endscript
}
EOF

# æ¸…ç†Dockeræ—¥å¿—
docker system prune -f
docker logs --since="24h" ppt_api > /dev/null
```

---

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æœåŠ¡æ— æ³•å¯åŠ¨

**ç—‡çŠ¶ï¼š** `docker-compose up` å¤±è´¥
```bash
# æ£€æŸ¥DockerçŠ¶æ€
sudo systemctl status docker

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep :5000

# æ£€æŸ¥é…ç½®æ–‡ä»¶
docker-compose config

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker-compose up --no-deps
```

#### 2. APIè¯·æ±‚è¶…æ—¶

**ç—‡çŠ¶ï¼š** è¯·æ±‚å¤„ç†æ—¶é—´è¿‡é•¿
```bash
# æ£€æŸ¥ç³»ç»Ÿèµ„æº
top
df -h

# æ£€æŸ¥å®¹å™¨èµ„æº
docker stats

# å¢åŠ è¶…æ—¶è®¾ç½®
# åœ¨nginx.confä¸­è°ƒæ•´ proxy_read_timeout
```

#### 3. è…¾è®¯äº‘COSä¸Šä¼ å¤±è´¥

**ç—‡çŠ¶ï¼š** ä¸Šä¼ è¿”å›é”™è¯¯
```bash
# éªŒè¯COSé…ç½®
curl -X POST \
     -H "Content-Type: application/json" \
     -d '{"test": "cos_config"}' \
     http://localhost:5000/health

# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping cos.ap-nanjing.myqcloud.com

# éªŒè¯è®¿é—®å¯†é’¥
# æ£€æŸ¥app.pyä¸­çš„COSé…ç½®
```

#### 4. å†…å­˜ä¸è¶³

**ç—‡çŠ¶ï¼š** å®¹å™¨è¢«æ€æ­»ï¼ˆOOMKilledï¼‰
```bash
# å¢åŠ å†…å­˜é™åˆ¶
# åœ¨docker-compose.ymlä¸­æ·»åŠ ï¼š
# deploy:
#   resources:
#     limits:
#       memory: 2G

# æˆ–è€…å‡çº§æœåŠ¡å™¨é…ç½®
```

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼
export FLASK_ENV=development
export FLASK_DEBUG=1

# æˆ–è€…ä¿®æ”¹docker-compose.yml:
# environment:
#   - FLASK_ENV=development
#   - FLASK_DEBUG=1

# é‡å¯æœåŠ¡
docker-compose restart
```

### æ—¥å¿—åˆ†æ

```bash
# å®æ—¶æŸ¥çœ‹APIæ—¥å¿—
docker logs -f ppt_api

# åˆ†æNginxè®¿é—®æ—¥å¿—
tail -f /var/log/nginx/ppt-api-access.log

# åˆ†æé”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/ppt-api-error.log

# ç»Ÿè®¡APIè°ƒç”¨æƒ…å†µ
awk '{print $7}' /var/log/nginx/ppt-api-access.log | sort | uniq -c | sort -nr
```

---

## æ€§èƒ½ä¼˜åŒ–

### ç³»ç»Ÿçº§ä¼˜åŒ–

```bash
# è°ƒæ•´ç³»ç»Ÿæ–‡ä»¶æè¿°ç¬¦é™åˆ¶
echo "* soft nofile 65536" | sudo tee -a /etc/security/limits.conf
echo "* hard nofile 65536" | sudo tee -a /etc/security/limits.conf

# ä¼˜åŒ–ç½‘ç»œå‚æ•°
sudo tee -a /etc/sysctl.conf << EOF
net.core.somaxconn = 65535
net.ipv4.tcp_max_syn_backlog = 65535
net.ipv4.tcp_fin_timeout = 30
EOF
sudo sysctl -p
```

### åº”ç”¨çº§ä¼˜åŒ–

```bash
# å¯ç”¨å¹¶å‘å¤„ç†
# åœ¨docker-compose.ymlä¸­å¢åŠ ç¯å¢ƒå˜é‡ï¼š
# environment:
#   - FLASK_ENV=production
#   - PYTHONUNBUFFERED=1
#   - WORKERS=4  # è®¾ç½®workeræ•°é‡
```

### ç¼“å­˜ä¼˜åŒ–

```bash
# é…ç½®Redisç¼“å­˜ï¼ˆå¯é€‰ï¼‰
# åœ¨docker-compose.ymlä¸­æ·»åŠ RedisæœåŠ¡ï¼š
# redis:
#   image: redis:alpine
#   ports:
#     - "6379:6379"
#   restart: unless-stopped
```

### ç›‘æ§æŒ‡æ ‡

å»ºç«‹ç›‘æ§æŒ‡æ ‡æ”¶é›†ï¼š

```bash
# åˆ›å»ºç›‘æ§è„šæœ¬
cat > /usr/local/bin/ppt-api-metrics.sh << 'EOF'
#!/bin/bash
echo "timestamp,cpu_usage,memory_usage,disk_usage,api_response_time"
while true; do
    timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    memory_usage=$(free | grep Mem | awk '{printf "%.1f", $3/$2 * 100.0}')
    disk_usage=$(df -h /tmp | awk 'NR==2 {print $5}' | sed 's/%//')
    api_response_time=$(curl -w "%{time_total}" -s -o /dev/null http://localhost:5000/health)

    echo "$timestamp,$cpu_usage,$memory_usage,$disk_usage,$api_response_time"
    sleep 60
done
EOF

chmod +x /usr/local/bin/ppt-api-metrics.sh
```

---

## å®‰å…¨å»ºè®®

### åŸºç¡€å®‰å…¨é…ç½®

```bash
# 1. æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# 2. é…ç½®é˜²ç«å¢™
sudo ufw enable
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# 3. ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡
sudo systemctl disable bluetooth
sudo systemctl disable cups

# 4. è®¾ç½®è‡ªåŠ¨å®‰å…¨æ›´æ–°
sudo apt install -y unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades
```

### APIå®‰å…¨

```bash
# 1. æ·»åŠ APIå¯†é’¥è®¤è¯ï¼ˆå¯é€‰ï¼‰
# åœ¨app.pyä¸­æ·»åŠ è®¤è¯ä¸­é—´ä»¶

# 2. é™åˆ¶è¯·æ±‚é¢‘ç‡
# ä½¿ç”¨nginxé™åˆ¶ï¼š
# limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
# limit_req zone=api burst=20 nodelay;

# 3. éšè—æœåŠ¡å™¨ä¿¡æ¯
# åœ¨nginx.confä¸­æ·»åŠ ï¼š
# server_tokens off;
```

---

## æ€»ç»“

æœ¬æ–‡æ¡£æä¾›äº†PPTæ–‡ä»¶è¶…é“¾æ¥è½¬æ¢ç³»ç»Ÿçš„å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š

âœ… **4ç§éƒ¨ç½²æ–¹å¼**ï¼šä»ç®€å•åˆ°å¤æ‚ï¼Œé€‚åº”ä¸åŒåœºæ™¯éœ€æ±‚
âœ… **è¯¦ç»†æ­¥éª¤è¯´æ˜**ï¼šæ¯ä¸ªæ­¥éª¤éƒ½æœ‰å…·ä½“çš„å‘½ä»¤å’Œé¢„æœŸç»“æœ
âœ… **å®Œæ•´çš„è¿ç»´æŒ‡å—**ï¼šåŒ…å«ç›‘æ§ã€å¤‡ä»½ã€æ•…éšœæ’é™¤ç­‰
âœ… **æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼šç³»ç»Ÿçº§å’Œåº”ç”¨çº§çš„ä¼˜åŒ–æ–¹æ¡ˆ
âœ… **å®‰å…¨é…ç½®å»ºè®®**ï¼šä¿éšœç”Ÿäº§ç¯å¢ƒå®‰å…¨

### å¿«é€Ÿé€‰æ‹©æŒ‡å—

| éœ€æ±‚ | æ¨èæ–¹æ¡ˆ | éƒ¨ç½²æ—¶é—´ |
|------|----------|----------|
| å¿«é€Ÿæµ‹è¯• | å¿«é€Ÿéƒ¨ç½²æ–¹æ¡ˆ | 5åˆ†é’Ÿ |
| å°å›¢é˜Ÿä½¿ç”¨ | ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆ | 15åˆ†é’Ÿ |
| ä¼ä¸šçº§åº”ç”¨ | é«˜å¯ç”¨ç”Ÿäº§ç¯å¢ƒæ–¹æ¡ˆ | 30åˆ†é’Ÿ |

é€‰æ‹©é€‚åˆæ‚¨çš„æ–¹æ¡ˆï¼ŒæŒ‰ç…§æ–‡æ¡£æ­¥éª¤æ‰§è¡Œå³å¯å¿«é€Ÿéƒ¨ç½²PPTè¶…é“¾æ¥è½¬æ¢ç³»ç»Ÿï¼

---

ğŸ“ **æŠ€æœ¯æ”¯æŒ**ï¼šå¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥[æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)ç« èŠ‚æˆ–æŸ¥çœ‹é¡¹ç›®æ—¥å¿—ã€‚